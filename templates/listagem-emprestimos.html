<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empréstimos do Cliente</title>
    <!-- Incluindo a biblioteca do Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }
        h1 { font-size: 1.875rem; }
        h2 { font-size: 1.5rem; }
        h3 { font-size: 1.25rem; }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-white shadow-md">
        <div class="container mx-auto p-4 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-gray-800">
                GERENCIAMENTO DE CLIENTES
            </h1>
            <nav>
                <a href="/" class="text-gray-600 hover:text-blue-500 font-semibold px-3 py-2 rounded-md">Cadastro</a>
                <a href="/listagem" class="text-gray-600 hover:text-blue-500 font-semibold px-3 py-2 rounded-md">Listagem</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4">
        <section class="mt-8">
            <div class="bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto">
                <h2 class="text-2xl font-semibold text-center mb-6 text-gray-700">
                    Empréstimos do Cliente: <span id="cliente-nome" class="font-bold"></span>
                </h2>
                
                <table class="min-w-full table-auto">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 text-left">Valor Emprestado</th>
                            <th class="py-3 px-6 text-left">Juros ao Mês (%)</th>
                            <th class="py-3 px-6 text-left">Nº de Meses</th>
                            <th class="py-3 px-6 text-left">Detalhes</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-emprestimos" class="text-gray-600 text-sm font-light">
                        <!-- As linhas de empréstimos serão inseridas aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        const tabelaEmprestimos = document.getElementById('tabela-emprestimos');
        const clienteNomeSpan = document.getElementById('cliente-nome');
        const API_URL_CLIENTE = 'http://127.0.0.1:5000/clientes';
        const API_URL_EMPRESTIMO = 'http://127.0.0.1:5000/emprestimos';

        // Função para extrair o telefone da URL
        function getTelefoneFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('telefone');
        }

        // Função para carregar e exibir os empréstimos na tabela
        async function carregarEmprestimos() {
            const telefoneCliente = getTelefoneFromUrl();
            if (!telefoneCliente) {
                alert('Telefone do cliente não encontrado. Redirecionando...');
                window.location.href = '/listagem';
                return;
            }

            try {
                // Primeiro, busca o nome do cliente para o cabeçalho
                const responseCliente = await fetch(`${API_URL_CLIENTE}/${telefoneCliente}`);
                const cliente = await responseCliente.json();
                clienteNomeSpan.textContent = cliente.nome;

                // Depois, busca a lista de empréstimos
                const responseEmprestimos = await fetch(`${API_URL_EMPRESTIMO}/${telefoneCliente}`);
                const emprestimos = await responseEmprestimos.json();
                
                tabelaEmprestimos.innerHTML = ''; // Limpa a tabela antes de preencher

                if (emprestimos.length === 0) {
                    const row = document.createElement('tr');
                    const cell = document.createElement('td');
                    cell.colSpan = 4;
                    cell.classList.add('py-3', 'px-6', 'text-center', 'text-gray-500', 'italic');
                    cell.textContent = 'Nenhum empréstimo cadastrado para este cliente.';
                    row.appendChild(cell);
                    tabelaEmprestimos.appendChild(row);
                    return;
                }

                emprestimos.forEach(emprestimo => {
                    const row = document.createElement('tr');
                    row.classList.add('border-b', 'border-gray-200', 'hover:bg-gray-100');

                    const valorCell = document.createElement('td');
                    valorCell.classList.add('py-3', 'px-6', 'text-left', 'whitespace-nowrap');
                    valorCell.textContent = `R$ ${parseFloat(emprestimo.valor_emprestado).toFixed(2)}`;

                    const jurosCell = document.createElement('td');
                    jurosCell.classList.add('py-3', 'px-6', 'text-left');
                    jurosCell.textContent = `${parseFloat(emprestimo.juros_mensal).toFixed(2)}%`;

                    const mesesCell = document.createElement('td');
                    mesesCell.classList.add('py-3', 'px-6', 'text-left');
                    mesesCell.textContent = emprestimo.num_meses;

                    const detalhesCell = document.createElement('td');
                    detalhesCell.classList.add('py-3', 'px-6', 'text-left');
                    detalhesCell.textContent = emprestimo.detalhes || '-';

                    row.appendChild(valorCell);
                    row.appendChild(jurosCell);
                    row.appendChild(mesesCell);
                    row.appendChild(detalhesCell);

                    tabelaEmprestimos.appendChild(row);
                });
            } catch (error) {
                console.error('Erro:', error);
                alert("Erro ao conectar ao servidor. Verifique se o backend está rodando.");
            }
        }

        document.addEventListener('DOMContentLoaded', carregarEmprestimos);
    </script>
</body>
</html>
```

**Salve o arquivo `listagem-emprestimos.html` com esse código.**

---

### **Próximos Passos (Ação Imediata)**

1.  **Reinicie o Servidor Flask:** No terminal do VS Code, pressione `Ctrl + C` para parar o servidor e execute `python app.py` novamente.
2.  **Teste o Fluxo:**
    * Acesse `http://127.0.0.1:5000/`.
    * Vá para a `Listagem`.
    * Clique no botão "Financiamento" de um cliente.
    * Faça uma simulação e clique em "CALCULAR E SALVAR".
    * A página deve redirecionar corretamente para a `listagem-emprestimos.html`, e a tabela deve exibir o empréstimo que você acabou de cadastrar.

Quando você tiver testado e confirmado que o fluxo completo de financiamento e listagem de empréstimos está funcionando, me diga `OK, TUDO FUNCIONANDO`.